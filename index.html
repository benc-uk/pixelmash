<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Mash</title>
    <script type="module" src="/app/main.js"></script>
    <link rel="shortcut icon" href="icon.png" type="image/png" />
  </head>

  <body x-data="app">
    <nav x-show="sourceLoaded">
      <template x-for="(effect, index) in $store.effects" :key="index">
        <section>
          <b x-text="effect.name"></b>
          <form>
            <template x-for="(param, name) in effect.params" :key="index + '-' + name">
              <div class="row">
                <label x-text="name" :for="name + '-' + index"></label>
                <input
                  class="wide"
                  type="range"
                  x-model="effect.params[name].value"
                  :min="effect.params[name].min"
                  :max="effect.params[name].max"
                  :step="effect.params[name].step"
                />
              </div>
            </template>
          </form>
        </section>
      </template>

      <div class="row">
        <button
          class="wide"
          x-show="!pickNewEffect && sourceLoaded"
          @click="pickNewEffect=true; $refs.effectSelector.focus()"
        >
          Add Effect
        </button>
        <select x-show="pickNewEffect" @change="addEffect($event.target.value)" class="wide" x-ref="effectSelector">
          <option disabled selected>Choose effect</option>
          <template x-for="(effectName, index) in effectList" :key="index">
            <option :value="effectName" x-text="effectName"></option>
          </template>
          <option value="__cancel__">- Cancel -</option>
        </select>
      </div>
    </nav>
    <div class="nav-sizer" draggable="true" @drag="dragNavSizer($event)"></div>

    <main
      @resize.window="resize(this)"
      @drop.prevent="dropImage($event)"
      @dragover.prevent="$event.dataTransfer.dropEffect = 'copy'"
    >
      <canvas width="800" height="600"></canvas>
      <div class="overlay" x-show="!sourceLoaded">Drag and drop any image here to start</div>
    </main>
  </body>
</html>
