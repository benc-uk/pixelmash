<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Mash</title>
    <script type="module" src="/app/main.js"></script>
    <link rel="shortcut icon" href="icon.png" type="image/png" />
  </head>

  <body x-data="app">
    <nav x-show="sourceLoaded">
      <template x-for="(effect, index) in $store.effects" :key="index">
        <section>
          <b draggable="true" @dragstart="dragEffect($event, index)" @dragover.prevent>
            <span x-text="effect.name"></span>
            <button class="tiny" @click="removeEffect(index)">тип</button>
          </b>
          <form>
            <template x-for="(param, name) in effect.params" :key="index + '-' + name">
              <div class="col">
                <label x-text="name" :for="name + '-' + index"></label>
                <input
                  type="range"
                  x-show="param.type === 'number'"
                  x-model="param.value"
                  :min="param.min"
                  :max="param.max"
                  :step="param.step"
                />
                <input type="color" x-show="param.type === 'colour'" x-model="param.value" />
              </div>
            </template>
          </form>
        </section>
      </template>

      <div class="row">
        <button
          class="wide"
          x-show="!pickNewEffect && sourceLoaded"
          @click="pickNewEffect=true; $refs.effectSelector.focus()"
        >
          Add Effect
        </button>
        <select x-show="pickNewEffect" @change="addEffect($event.target.value)" class="wide" x-ref="effectSelector">
          <option disabled selected>Choose effect</option>
          <template x-for="(effectName, index) in effectList" :key="index">
            <option :value="effectName" x-text="effectName"></option>
          </template>
          <option value="__cancel__">- Cancel -</option>
        </select>
      </div>
      <button class="wide" @click="clear">Clear</button>
      <button class="wide" @click="save">Save</button>
    </nav>

    <div class="nav-sizer" draggable="true" @drag="dragNavSizer($event)"></div>

    <main
      @resize.window="resize(this)"
      @drop.prevent="dropImage($event)"
      @dragover.prevent="$event.dataTransfer.dropEffect = 'copy'"
    >
      <canvas width="800" height="600"></canvas>
      <aside class="overlay" x-show="!sourceLoaded" @click="promptForFile">
        Drag and drop image here or click to upload
      </aside>
    </main>

    <input type="file" accept="image/*" x-ref="fileInput" @change="fileInputImage($event)" />
  </body>
</html>
